# Migration Scripts

‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö migrate ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å MongoDB ‡πÑ‡∏õ‡∏¢‡∏±‡∏á SQL Server

## üìã Prerequisites

1. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies:
```bash
npm install
```

2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ environment variables ‡πÉ‡∏ô `.env`:
```env
# MongoDB connection (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
MONGODB_URI=mongodb://localhost:27017/maajod
# ‡∏´‡∏£‡∏∑‡∏≠
MONGODB_URI=mongodb+srv://USER:PASSWORD@cluster.mongodb.net/maajod

# SQL Server connection (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
DATABASE_URL=sqlserver://localhost:1433;database=maajod;integratedSecurity=true;trustServerCertificate=true
```

## üöÄ ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: Direct Migration (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)

‡πÉ‡∏ä‡πâ TypeORM ‡πÄ‡∏û‡∏∑‡πà‡∏≠ migrate ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡∏à‡∏≤‡∏Å MongoDB ‡πÑ‡∏õ SQL Server:

```bash
npm run migrate:mongo-to-sql
```

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:**
- ‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏•‡∏∞‡∏á‡πà‡∏≤‡∏¢
- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ relationships ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
- ‡πÅ‡∏õ‡∏•‡∏á ObjectId ‡πÄ‡∏õ‡πá‡∏ô UUID ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

**‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á:**
- ‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏ô SQL Server ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ MongoDB ‡πÅ‡∏•‡∏∞ SQL Server ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: Export to SQL File

Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å MongoDB ‡πÄ‡∏õ‡πá‡∏ô SQL script file:

```bash
npm run export:mongo-to-sql
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `mongodb-export.sql` ‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå `api/`
- ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏£‡∏±‡∏ô‡πÉ‡∏ô SQL Server Management Studio (SSMS) ‡∏´‡∏£‡∏∑‡∏≠ sqlcmd

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:**
- ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö SQL statements ‡∏Å‡πà‡∏≠‡∏ô‡∏£‡∏±‡∏ô
- ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç SQL ‡πÑ‡∏î‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏£‡∏±‡∏ô
- ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ MongoDB ‡πÅ‡∏•‡∏∞ SQL Server ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô

**‡∏ß‡∏¥‡∏ò‡∏µ‡∏£‡∏±‡∏ô SQL file:**
```bash
# ‡πÉ‡∏ä‡πâ sqlcmd
sqlcmd -S localhost -d maajod -i mongodb-export.sql

# ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô SQL Server Management Studio
```

## üìä ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà script ‡∏à‡∏∞‡∏ó‡∏≥

1. **Users** - Migrate ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
   - ‡πÅ‡∏õ‡∏•‡∏á ObjectId ‡πÄ‡∏õ‡πá‡∏ô UUID
   - ‡πÄ‡∏Å‡πá‡∏ö password hash ‡πÑ‡∏ß‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°

2. **Stores** - Migrate ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
   - ‡πÅ‡∏õ‡∏•‡∏á ObjectId ‡πÄ‡∏õ‡πá‡∏ô UUID

3. **UserStores** - Migrate ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå user-store
   - ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó userId ‡πÅ‡∏•‡∏∞ storeId ‡πÄ‡∏õ‡πá‡∏ô UUID ‡πÉ‡∏´‡∏°‡πà

4. **Transactions** - Migrate transaction ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
   - ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó storeId ‡πÄ‡∏õ‡πá‡∏ô UUID ‡πÉ‡∏´‡∏°‡πà

## ‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á

1. **Backup ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô migrate** - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏ô SQL Server ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö

2. **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö connection strings** - ‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ MongoDB ‡πÅ‡∏•‡∏∞ SQL Server connection strings ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

3. **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏á migrate** - ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô records ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏´‡∏•‡∏±‡∏á migrate ‡πÄ‡∏™‡∏£‡πá‡∏à

4. **UUID vs ObjectId** - IDs ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô UUID ‡πÉ‡∏´‡∏°‡πà ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô:
   - ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ IDs ‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏î‡πâ
   - Frontend ‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á refresh ‡∏´‡∏£‡∏∑‡∏≠ login ‡πÉ‡∏´‡∏°‡πà

## üîç Troubleshooting

### Error: Cannot connect to MongoDB
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö `MONGODB_URI` ‡πÉ‡∏ô `.env`
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ MongoDB service ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà

### Error: Cannot connect to SQL Server
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö `DATABASE_URL` ‡πÉ‡∏ô `.env`
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ SQL Server service ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ database `maajod` ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß

### Error: Foreign key constraint
- ‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ migrate ‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö: Users ‚Üí Stores ‚Üí UserStores ‚Üí Transactions
- Script ‡∏à‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

## üìù Notes

- Script ‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á UUID ‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å record
- Password hashes ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á hash ‡πÉ‡∏´‡∏°‡πà)
- Timestamps ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°

